<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet"/> 
    <link rel="shortcut icon" href="/img/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="css/print.css">
    <script src="js/print.js"></script>
</head>
<body>


     <nav class="navbar">
        <div class="logo"><img src="/img/logo.png" alt="" width="70" height="70">
        <h2>his'</h2>
        </div>

        <div class="nav-links">
            <ul>
                <li><a href="/">Anasayfa</a></li>
                <li><a href="/tests">Psikolojik Testler</a></li>
                <li><a href="/print">Blog</a></li>
                <li><a href="/about">Hakkımızda</a></li>

                
            </ul>
        </div>

        <ul class="icons">
     <script>
fetch('/session-user')
  .then(res => res.json())
  .then(data => {
    const navbar = document.querySelector('.icons');

    const dynamicItems = navbar.querySelectorAll('.dynamic');
    dynamicItems.forEach(item => item.remove());

    if(data.user){ // kullanıcı girili ise
      const liLogout = document.createElement('li');
      liLogout.classList.add('dynamic');
      liLogout.innerHTML = `<a href="/logout"><i class="ri-logout-box-line"></i></a>`;
      navbar.appendChild(liLogout);
    } else { // kullnaıcı girili değilse login butonu eklenecek
      const liLogin = document.createElement('li');
      liLogin.classList.add('dynamic');
      liLogin.innerHTML = `<a href="/login"><i class="ri-login-box-line"></i></a>`;
      navbar.appendChild(liLogin);
    }
  });

        </script>
           <button class="theme" onclick="toggleTheme()"><i class="ri-contrast-line"></i></button> 
            <a target="_blank" href="https://www.instagram.com/busee.krglu/"><i class="ri-instagram-line"></i> </a> 
            <a target="_blank" href="mailto:buse.krgl20@gmail.com"><i class="ri-mail-line"></i></a>
            <a target="_blank" href="https://www.linkedin.com/in/buse-k%C3%B6ro%C4%9Flu-7426a6284?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"><i class="ri-linkedin-box-line"></i></a>
           
        </ul> 
        
         <button class="menu" onclick="menuBar()"><i class="ri-menu-line"></i></button>
        
 </nav> 


   <main>

     <div id="menu" class="iconCollapse">
            <ul class="icons">
            <li><a href="/register"><i class="ri-user-add-line"></i> Kayıt Ol</a></li>     
            <li><a href="/login"><i class="ri-login-box-line"></i> Giriş Yap</a></li>               
            <li><button class="theme" onclick="toggleTheme()"><i class="ri-contrast-line"></i> Tema</button></li> 
            <li><a target="_blank" href="https://www.instagram.com/busee.krglu/"><i class="ri-instagram-line"></i> Instagram </a></li>
            <li><a target="_blank" href="mailto:buse.krgl20@gmail.com"><i class="ri-mail-line"></i> Email</a></li>
            <li><a target="_blank" href="https://www.linkedin.com/in/buse-k%C3%B6ro%C4%9Flu-7426a6284?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"><i class="ri-linkedin-box-line"></i> Linkedin</a></li> 
          </ul> </div>


      <div class="metin">
     
    <div class="giris">
      <h1>Düşüncelerini, hislerini bizimle paylaşmaya var mısın?</h1>

     <form id="noteForm" method="POST" action="/print">
       <input id="noteTitle" class="baslik" type="text" name="title" placeholder="Başlık" required />
       <div id="noteContent" class="writing" contenteditable="true" name="content" style="height: 300px;"></div>
         <input type="hidden" name="content" id="hiddenContent" style="display: none;">
 </div>
     
    
    


  <div class="text_box">
    <select>
      <option>Normal</option>
    </select>
    <button type="button" onclick="document.execCommand('bold',false,'')"><b>B</b></button>
    <button type="button" onclick="document.execCommand('italic',false,'')"><i>I</i></button>
    <button type="button" onclick="document.execCommand('underline',false,'')"><u>U</u></button>
  </div>

     <button class="sub-button" type="submit">Paylaş</button>

          </form> 


<script>
const form = document.getElementById('noteForm');

const contentDiv = document.getElementById('noteContent');
const hiddenInput = document.getElementById('hiddenContent');

form.addEventListener('submit', (e) => {
  hiddenInput.value = contentDiv.innerHTML; // veya textContent sadece metin istiyorsan
});



form.addEventListener('submit', async (e) => {
    e.preventDefault(); // önce formun normal gönderilmesini engelle

    try {
        const res = await fetch('/session-user');
        const data = await res.json();

        if (!data.user) { // kullanıcı giriş yapmamışsa
            alert("Lütfen önce kayıt olun veya giriş yapın!");
            return; // form gönderimini durdur
        }

        // kullanıcı giriş yaptıysa formu normal şekilde gönderebiliriz
        form.submit(); // burada form gönderimi manuel yapılır

    } catch (err) {
        console.error("Kullanıcı kontrolü sırasında hata:", err);
        alert("Bir hata oluştu. Lütfen tekrar deneyin.");
    }
});
</script>



  </div>  



      </div>


          <div class="direct">
            <p>Eğer okumak için burdaysan "Okumaya Başla" başka kişilerin paylaştığı yazıları okuyabilirsin.</p>

            <button class="oku-button"><a href="/posts">Okumaya Başla</a></button>
          </div>


   </main>
    
</body>
</html>